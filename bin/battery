#!/bin/sh

if [[ "$(uname)" = *Darwin* ]]; then
    # Executable for tmux status line
    smart_battery_status="$(ioreg -rc "AppleSmartBattery")"
    typeset maxcapacity=$(echo $smart_battery_status \
                        | grep '^.*"MaxCapacity"\ =\ ' \
                        | sed -e 's/^.*"MaxCapacity"\ =\ //' \
                        | cut -d" " -f1)
    typeset currentcapacity=$(echo $smart_battery_status \
                            | grep '^.*"CurrentCapacity"\ =\ ' \
                            | sed -e 's/^.*CurrentCapacity"\ =\ //' \
                            | cut -d" " -f1)

    if [[ $currentcapacity ]] && [[ $maxcapacity ]]; then
        percent=$((100 * currentcapacity/(maxcapacity - 1)))
    fi
fi

if [[ $percent ]]; then
    if [[ "$percent" = "100" ]]; then
        echo "[^.^]"
    else
        echo '['$percent'%]'
    fi
else
    echo ''
fi
