#!/bin/bash

# Executable for tmux status line

tell_app_to(){
    local cmd="tell application \"$1\" to $2"
    echo $(osascript -e "$cmd" 2>/dev/null)
}

apps=("iTunes" "Spotify" "Rdio")

if [[ $(uname) = *Darwin* ]]; then
    for app in "${apps[@]}"; do
        running=$(tell_app_to "System Events" "(name of processes) contains \"$app\"")
        if [[ $running = "true" ]]; then
            state=$(tell_app_to $app "player state as string")
            if [[ $state = "playing" ]]; then
                artist=$(tell_app_to $app "artist of current track as string")
                track=$(tell_app_to $app "name of current track as string")
                echo "[ â™«  $artist - $track ]"
                exit 0
            fi
        fi
    done
fi
